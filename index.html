<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Les Restos de Matt‚Äôs - Paris Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: black;
            color: white;
            margin: 0;
            overflow: hidden;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .glass { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1); 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        .animate-in { animation: fadeIn 0.4s ease-out forwards; }
        
        @keyframes pulse-slow { 
            0%, 100% { opacity: 0.3; transform: scale(1); } 
            50% { opacity: 0.4; transform: scale(1.05); } 
        }
        .animate-pulse-slow { animation: pulse-slow 8s infinite ease-in-out; }
    </style>
</head>
<body>
    <div id="app" class="relative w-full h-screen overflow-hidden bg-black text-white selection:bg-white/20">
        <!-- Background -->
        <div class="absolute inset-0 pointer-events-none overflow-hidden">
            <div class="absolute top-[-20%] left-[-10%] w-[80%] h-[70%] bg-blue-600/20 blur-[120px] animate-pulse-slow rounded-full"></div>
            <div class="absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] bg-indigo-900/30 blur-[120px] rounded-full"></div>
        </div>

        <div class="relative z-10 flex flex-col h-full max-w-md mx-auto bg-black/20 md:bg-transparent md:border-x md:border-white/5">
            <!-- Header -->
            <header class="pt-12 pb-6 px-6 flex justify-between items-start shrink-0">
                <div id="main-header-text">
                    <h1 class="text-3xl font-black italic tracking-tighter uppercase drop-shadow-lg leading-none">
                        Les Restos<br><span class="text-blue-500">de Matt‚Äôs</span>
                    </h1>
                    <p class="text-[9px] font-bold text-white/40 uppercase tracking-[0.3em] mt-2 pl-1">√âdition Paris Premium</p>
                </div>
                
                <!-- Dynamic Header for Lists -->
                <div id="list-header-text" class="hidden">
                    <button onclick="closeList()" class="text-[10px] font-bold text-white/50 uppercase tracking-widest mb-1 flex items-center gap-1 hover:text-white">
                        <i data-lucide="arrow-left" class="w-3 h-3"></i> Retour
                    </button>
                    <h1 id="current-list-title" class="text-2xl font-black italic tracking-tighter uppercase text-blue-500"></h1>
                </div>

                <div class="flex gap-2">
                    <!-- Share Button (Visible only in List Mode) -->
                    <button id="share-btn" onclick="shareCurrentList()" class="hidden p-3 bg-white/5 backdrop-blur-xl rounded-full border border-white/10 text-white active:scale-90 transition-all hover:bg-white/10">
                        <i data-lucide="share-2" class="w-5 h-5"></i>
                    </button>
                    
                    <!-- AI Button -->
                    <button id="ai-btn" onclick="generateRecommendations()" class="p-3 bg-white/5 backdrop-blur-xl rounded-full border border-blue-500/30 text-blue-400 active:scale-90 transition-all hover:bg-blue-500/20 hover:text-white shadow-[0_0_15px_rgba(59,130,246,0.3)]">
                        <i data-lucide="sparkles" class="w-5 h-5"></i>
                    </button>
                    
                    <!-- Add Button -->
                    <button onclick="toggleModal('modal-add-resto')" class="p-3 bg-white text-black rounded-full shadow-lg active:scale-90 transition-all hover:bg-gray-200">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                    </button>
                </div>
            </header>

            <!-- Search Bar (Only in Main Carnet) -->
            <div id="search-container" class="px-6 mb-4 shrink-0 transition-all duration-300">
                <div class="relative group">
                    <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-white/30 w-4 h-4 transition-colors group-focus-within:text-white"></i>
                    <input 
                        type="text" 
                        id="search-input"
                        placeholder="Rechercher une adresse..."
                        oninput="renderRestaurants()"
                        class="w-full bg-white/5 border border-white/10 rounded-2xl py-3.5 pl-11 pr-4 text-sm font-medium focus:outline-none focus:bg-white/10 focus:border-white/30 transition-all placeholder:text-white/20"
                    >
                </div>
            </div>

            <!-- Content Area -->
            <div id="main-content" class="flex-1 overflow-y-auto px-6 pb-32 no-scrollbar space-y-6">
                
                <!-- Recommendations Section -->
                <section id="recommendations-section" class="hidden animate-in">
                    <div class="flex items-center justify-between mb-3 px-1">
                        <div class="flex items-center gap-2 text-yellow-400">
                            <i data-lucide="zap" class="w-3.5 h-3.5 fill-current"></i>
                            <h2 class="text-[10px] font-black uppercase tracking-widest">Suggestions Flash</h2>
                        </div>
                        <button onclick="closeRecommendations()" class="text-[9px] text-white/30 font-bold uppercase hover:text-white">Fermer</button>
                    </div>
                    <div id="reco-list" class="flex gap-3 overflow-x-auto no-scrollbar pb-2 px-1 -mx-1 snap-x"></div>
                </section>

                <!-- List Section (Carnet or Specific List) -->
                <section id="list-section" class="space-y-4 min-h-[50vh]">
                    <!-- Filters (Only visible in Main Carnet) -->
                    <div id="main-filters" class="flex justify-between items-center px-1 sticky top-0 z-20 backdrop-blur-md py-2 -mx-2 px-3 rounded-xl">
                        <h2 class="text-[10px] font-black uppercase tracking-widest text-white/40">Mon Carnet</h2>
                        <div class="flex gap-1 bg-white/5 p-1 rounded-full border border-white/5">
                            <button onclick="setFilter('all')" class="filter-btn text-[9px] font-bold px-3 py-1 rounded-full transition-all bg-white text-black shadow-sm" data-filter="all">TOUS</button>
                            <button onclick="setFilter('wishlist')" class="filter-btn text-[9px] font-bold px-3 py-1 rounded-full transition-all text-white/40 hover:text-white hover:bg-white/10" data-filter="wishlist">√Ä TESTER</button>
                            <button onclick="setFilter('visited')" class="filter-btn text-[9px] font-bold px-3 py-1 rounded-full transition-all text-white/40 hover:text-white hover:bg-white/10" data-filter="visited">FAIT</button>
                        </div>
                    </div>
                    <div id="resto-list" class="space-y-3 pb-4"></div>
                </section>

                <!-- Folders Grid (Only visible in Folders Tab) -->
                <section id="folders-section" class="hidden space-y-6 animate-in">
                    <div class="flex justify-between items-center px-1">
                        <h2 class="text-[10px] font-black uppercase tracking-widest text-white/40">Mes Collections</h2>
                        <button onclick="toggleModal('modal-create-list')" class="flex items-center gap-2 text-[10px] font-bold text-blue-400 uppercase hover:text-white transition-colors">
                            <i data-lucide="folder-plus" class="w-3.5 h-3.5"></i> Nouvelle Liste
                        </button>
                    </div>
                    <div id="folders-grid" class="grid grid-cols-2 gap-3"></div>
                </section>
            </div>

            <!-- Navigation Tab Bar -->
            <nav class="absolute bottom-6 left-12 right-12 h-[4.5rem] bg-[#1a1a1a]/90 backdrop-blur-xl border border-white/10 rounded-[2.5rem] flex items-center justify-around px-2 shadow-[0_10px_40px_rgba(0,0,0,0.8)] z-40">
                <button onclick="switchTab('list')" class="nav-btn flex flex-col items-center gap-1 transition-all duration-300 w-20 scale-110" id="tab-list">
                    <div class="p-2.5 rounded-full bg-white/20 text-white shadow-[0_0_15px_rgba(255,255,255,0.2)] icon-container transition-all">
                        <i data-lucide="chef-hat" class="w-5 h-5"></i>
                    </div>
                    <span class="text-[9px] font-bold tracking-widest uppercase opacity-100 transition-opacity">Carnet</span>
                </button>
                <div class="w-px h-8 bg-white/10"></div>
                <button onclick="switchTab('folders')" class="nav-btn flex flex-col items-center gap-1 transition-all duration-300 w-20 opacity-50" id="tab-folders">
                    <div class="p-2.5 rounded-full bg-transparent text-white icon-container transition-all">
                        <i data-lucide="layers" class="w-5 h-5"></i>
                    </div>
                    <span class="text-[9px] font-bold tracking-widest uppercase hidden">Listes</span>
                </button>
            </nav>
        </div>

        <!-- MODAL: ADD RESTAURANT -->
        <div id="modal-add-resto" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/60 backdrop-blur-md animate-in" onclick="if(event.target === this) toggleModal('modal-add-resto')">
            <div class="glass w-full max-w-xs p-6 space-y-4 shadow-2xl bg-[#111] rounded-[24px] border border-white/10">
                <h2 class="text-lg font-black italic uppercase tracking-tighter mb-4">Nouveau Resto</h2>
                <div class="space-y-3">
                    <div class="relative">
                        <i data-lucide="store" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/30"></i>
                        <input id="new-resto-name" type="text" placeholder="Nom de l'√©tablissement" class="w-full bg-black/50 border border-white/10 rounded-xl py-3 pl-10 pr-3 text-sm text-white focus:outline-none focus:border-white/40">
                    </div>
                    <div class="relative">
                        <i data-lucide="utensils" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/30"></i>
                        <input id="new-resto-cuisine" type="text" placeholder="Type de cuisine (ex: Italien)" class="w-full bg-black/50 border border-white/10 rounded-xl py-3 pl-10 pr-3 text-sm text-white focus:outline-none focus:border-white/40">
                    </div>
                    <div class="relative">
                        <i data-lucide="folder" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/30"></i>
                        <select id="new-resto-list" class="w-full bg-black/50 border border-white/10 rounded-xl py-3 pl-10 pr-3 text-xs font-bold text-white focus:outline-none appearance-none">
                            <option value="main">Ajouter au Carnet G√©n√©ral</option>
                            <!-- Lists added dynamically -->
                        </select>
                        <i data-lucide="chevron-down" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/30 pointer-events-none"></i>
                    </div>
                </div>
                <div class="flex gap-2 pt-2">
                    <button onclick="addRestaurant()" class="flex-1 bg-white text-black py-3 rounded-xl font-bold text-xs uppercase tracking-widest hover:bg-gray-200 transition-colors active:scale-95">Ajouter</button>
                    <button onclick="toggleModal('modal-add-resto')" class="px-4 bg-white/5 rounded-xl hover:bg-white/10 transition-colors text-white/50 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
            </div>
        </div>

        <!-- MODAL: CREATE LIST -->
        <div id="modal-create-list" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/60 backdrop-blur-md animate-in" onclick="if(event.target === this) toggleModal('modal-create-list')">
            <div class="glass w-full max-w-xs p-6 space-y-4 shadow-2xl bg-[#111] rounded-[24px] border border-white/10">
                <h2 class="text-lg font-black italic uppercase tracking-tighter mb-4">Nouvelle Liste</h2>
                <div class="space-y-3">
                    <input id="new-list-name" type="text" placeholder="Titre de la liste (ex: Date Night)" class="w-full bg-black/50 border border-white/10 rounded-xl py-3 px-4 text-sm text-white focus:outline-none focus:border-white/40">
                </div>
                <div class="flex gap-2 pt-2">
                    <button onclick="createList()" class="flex-1 bg-blue-500 text-white py-3 rounded-xl font-bold text-xs uppercase tracking-widest hover:bg-blue-400 transition-colors active:scale-95">Cr√©er</button>
                    <button onclick="toggleModal('modal-create-list')" class="px-4 bg-white/5 rounded-xl hover:bg-white/10 transition-colors text-white/50 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
            </div>
        </div>

        <!-- MODAL: RESTAURANT DETAILS -->
        <div id="modal-details" class="hidden fixed inset-0 z-[100] flex items-end sm:items-center justify-center sm:p-6 bg-black/80 backdrop-blur-md animate-in" onclick="if(event.target === this) toggleModal('modal-details')">
            <div class="glass w-full max-w-sm bg-[#111] rounded-t-[2rem] sm:rounded-[24px] border-t sm:border border-white/10 overflow-hidden shadow-2xl relative">
                <button onclick="toggleModal('modal-details')" class="absolute top-4 right-4 z-20 p-2 bg-black/40 backdrop-blur-md rounded-full text-white/70 hover:text-white">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>

                <div class="h-48 relative">
                    <img id="detail-image" src="" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-[#111] to-transparent"></div>
                    <div class="absolute bottom-4 left-6">
                        <div id="detail-tags" class="flex gap-2 mb-2"></div>
                        <h2 id="detail-name" class="text-2xl font-black italic text-white leading-none"></h2>
                    </div>
                </div>

                <div class="p-6 pt-2 space-y-6">
                    <div class="flex justify-between items-center bg-white/5 p-4 rounded-2xl border border-white/5">
                        <div class="text-xs text-white/50 font-bold uppercase tracking-widest">Note</div>
                        <div id="detail-stars" class="flex gap-1 text-yellow-400"></div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="toggleStatusFromDetail()" id="btn-toggle-status" class="p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 active:scale-95 transition-all flex flex-col items-center gap-2">
                            <i data-lucide="check-circle" class="w-5 h-5"></i>
                            <span class="text-[10px] font-bold uppercase tracking-widest">Marquer Fait</span>
                        </button>
                        <button onclick="deleteRestoFromDetail()" class="p-4 rounded-xl bg-red-500/10 border border-red-500/20 hover:bg-red-500/20 active:scale-95 transition-all flex flex-col items-center gap-2 text-red-400">
                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                            <span class="text-[10px] font-bold uppercase tracking-widest">Supprimer</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- DATA & STATE ---
        // Simulating Database
        let restaurants = [
            { id: 1, name: "Girafe", cuisine: "Fruits de mer", status: "visited", rating: 5, listId: 'main', image: "https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?auto=format&fit=crop&w=600&q=80" },
            { id: 2, name: "Septime", cuisine: "Gastronomique", status: "visited", rating: 4, listId: 'main', image: "https://images.unsplash.com/photo-1559339352-11d035aa65de?auto=format&fit=crop&w=600&q=80" },
            { id: 3, name: "Pink Mamma", cuisine: "Italien", status: "wishlist", rating: 0, listId: 'main', image: "https://images.unsplash.com/photo-1552566626-52f8b828add9?auto=format&fit=crop&w=600&q=80" },
            { id: 4, name: "Holybelly 5", cuisine: "Brunch", status: "wishlist", rating: 0, listId: 'favs', image: "https://images.unsplash.com/photo-1594046243098-0fceea9d451e?auto=format&fit=crop&w=600&q=80" }
        ];

        let userLists = [
            { id: 'favs', title: "Coups de Coeur", icon: "heart" }, 
            { id: 'date', title: "Date Night", icon: "glass-water" },
            { id: 'biz', title: "Business", icon: "briefcase" }
        ];
        
        // Simulating "Fast Model" AI Database
        const aiDatabase = [
            { name: "Kodawari Ramen", cuisine: "Japonais", reason: "Immersion march√© Tokyo√Øte." },
            { name: "Le Train Bleu", cuisine: "Fran√ßais", reason: "D√©cor historique sublime." },
            { name: "Carbonis", cuisine: "Italien", reason: "P√¢tes et ambiance tamis√©e." },
            { name: "Miznon", cuisine: "Street Food", reason: "Le chou-fleur r√¥ti l√©gendaire." },
            { name: "Frenchie", cuisine: "Bistrot", reason: "La rue du Nil en effervescence." },
            { name: "Ober Mamma", cuisine: "Italien", reason: "Cocktails et pizzas truffe." },
            { name: "Double Dragon", cuisine: "Asiatique", reason: "Plats √©pic√©s √† partager." }
        ];

        let currentView = 'list'; // 'list' or 'folders'
        let currentListFilter = 'main'; // 'main' or list ID
        let filterStatus = 'all'; // 'all', 'wishlist', 'visited'
        let currentDetailId = null;

        // --- INIT ---
        window.onload = function() {
            lucide.createIcons();
            renderRestaurants();
            renderFolders();
            updateListSelect();
        };

        // --- NAVIGATION ---
        function switchTab(tab) {
            const listSection = document.getElementById('list-section');
            const searchContainer = document.getElementById('search-container');
            const foldersSection = document.getElementById('folders-section');
            const mainHeader = document.getElementById('main-header-text');
            const listHeader = document.getElementById('list-header-text');
            const shareBtn = document.getElementById('share-btn');
            const mainFilters = document.getElementById('main-filters');

            // Reset UI states
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.add('opacity-50');
                btn.classList.remove('scale-110');
                btn.querySelector('.icon-container').classList.remove('bg-white/20', 'shadow-[0_0_15px_rgba(255,255,255,0.2)]');
                btn.querySelector('span').classList.add('hidden');
            });

            // Activate Tab
            const activeBtn = document.getElementById(`tab-${tab}`);
            activeBtn.classList.remove('opacity-50');
            activeBtn.classList.add('scale-110');
            activeBtn.querySelector('.icon-container').classList.add('bg-white/20', 'shadow-[0_0_15px_rgba(255,255,255,0.2)]');
            activeBtn.querySelector('span').classList.remove('hidden');

            if (tab === 'list') {
                // If we were in a sub-list, return to main view
                if (currentListFilter !== 'main') closeList();
                
                listSection.classList.remove('hidden');
                searchContainer.classList.remove('hidden');
                foldersSection.classList.add('hidden');
                shareBtn.classList.add('hidden');
                mainFilters.classList.remove('hidden');
                renderRestaurants();
            } else {
                listSection.classList.add('hidden');
                searchContainer.classList.add('hidden');
                foldersSection.classList.remove('hidden');
                shareBtn.classList.add('hidden');
                // Ensure header is reset
                mainHeader.classList.remove('hidden');
                listHeader.classList.add('hidden');
                renderFolders();
            }
            lucide.createIcons();
        }

        // --- LIST LOGIC ---
        function openList(listId) {
            currentListFilter = listId;
            const listData = userLists.find(l => l.id === listId);
            
            // Switch UI to List Mode
            document.getElementById('list-section').classList.remove('hidden');
            document.getElementById('folders-section').classList.add('hidden');
            document.getElementById('search-container').classList.add('hidden');
            document.getElementById('main-filters').classList.add('hidden'); // Hide status filters in custom list view

            // Header Update
            document.getElementById('main-header-text').classList.add('hidden');
            const listHeader = document.getElementById('list-header-text');
            listHeader.classList.remove('hidden');
            document.getElementById('current-list-title').innerText = listData.title;
            document.getElementById('share-btn').classList.remove('hidden');

            renderRestaurants();
        }

        function closeList() {
            currentListFilter = 'main';
            document.getElementById('list-header-text').classList.add('hidden');
            document.getElementById('main-header-text').classList.remove('hidden');
            document.getElementById('share-btn').classList.add('hidden');
            
            // Return to appropriate tab view
            switchTab('list'); // Default back to main carnet
        }

        function createList() {
            const name = document.getElementById('new-list-name').value;
            if(!name) return;

            const newList = {
                id: 'list-' + Date.now(),
                title: name,
                icon: 'folder'
            };
            userLists.push(newList);
            toggleModal('modal-create-list');
            document.getElementById('new-list-name').value = '';
            renderFolders();
            updateListSelect();
            showNotice("Liste cr√©√©e !");
        }

        function deleteList(id, event) {
            event.stopPropagation();
            if(confirm("Supprimer cette liste et son contenu ?")) {
                userLists = userLists.filter(l => l.id !== id);
                // Move items back to main or delete them? Let's keep them in main but remove listId
                restaurants.forEach(r => {
                    if(r.listId === id) r.listId = 'main';
                });
                renderFolders();
                updateListSelect();
                showNotice("Liste supprim√©e");
            }
        }

        function shareCurrentList() {
            const listTitle = currentListFilter === 'main' ? "Mon Carnet" : userLists.find(l => l.id === currentListFilter).title;
            const items = restaurants.filter(r => currentListFilter === 'main' ? true : r.listId === currentListFilter);
            
            let text = `üçΩÔ∏è *${listTitle}* - Les Restos de Matt's\n\n`;
            items.forEach(r => {
                text += `‚Ä¢ ${r.name} (${r.cuisine})\n`;
            });

            navigator.clipboard.writeText(text).then(() => {
                showNotice("Liste copi√©e !");
            }).catch(() => {
                showNotice("Erreur de copie");
            });
        }

        // --- RESTAURANT LOGIC ---
        function renderRestaurants() {
            const container = document.getElementById('resto-list');
            const query = document.getElementById('search-input').value.toLowerCase();

            const filtered = restaurants.filter(r => {
                // 1. Filter by List Context
                const inList = currentListFilter === 'main' 
                    ? true // Show all in Main Carnet? Or just those with 'main'? usually Main shows ALL.
                    : r.listId === currentListFilter;

                // 2. Filter by Status (Only in Main View)
                const inStatus = currentListFilter !== 'main' 
                    ? true 
                    : (filterStatus === 'all' || r.status === filterStatus);
                
                // 3. Search
                const inSearch = r.name.toLowerCase().includes(query) || r.cuisine.toLowerCase().includes(query);

                return inList && inStatus && inSearch;
            });

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-12 opacity-30">
                        <i data-lucide="ghost" class="w-8 h-8 mb-2"></i>
                        <div class="text-xs font-bold uppercase tracking-widest">Vide</div>
                    </div>`;
            } else {
                container.innerHTML = filtered.map(resto => `
                    <div onclick="openRestoDetails(${resto.id})" class="glass relative overflow-hidden active:scale-95 transition-all group cursor-pointer hover:bg-white/10 rounded-[20px] animate-in border-0 bg-[#161616]">
                        <div class="flex h-24">
                            <div class="w-24 h-full relative shrink-0">
                                <img src="${resto.image}" class="w-full h-full object-cover" alt="${resto.name}">
                                <div class="absolute inset-0 bg-gradient-to-r from-black/20 to-transparent"></div>
                            </div>
                            <div class="flex-1 p-3.5 flex flex-col justify-between">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-bold text-white text-[15px] leading-tight mb-0.5">${resto.name}</h3>
                                        <p class="text-[9px] text-white/50 font-bold uppercase tracking-widest">${resto.cuisine}</p>
                                    </div>
                                    ${resto.status === 'visited' 
                                        ? `<div class="bg-emerald-500/10 p-1 rounded-full"><i data-lucide="check" class="w-3 h-3 text-emerald-400"></i></div>` 
                                        : `<div class="bg-white/5 p-1 rounded-full"><i data-lucide="bookmark" class="w-3 h-3 text-white/30"></i></div>`}
                                </div>
                                <div class="flex justify-between items-end">
                                    <div class="flex items-center gap-1">
                                        ${Array(5).fill(0).map((_, i) => `<i data-lucide="star" class="w-2.5 h-2.5 ${i < resto.rating ? 'fill-yellow-400 text-yellow-400' : 'fill-white/5 text-white/10'}"></i>`).join('')}
                                    </div>
                                    ${resto.listId !== 'main' ? `<span class="text-[8px] bg-blue-500/20 text-blue-300 px-1.5 py-0.5 rounded font-bold uppercase">${getListTitle(resto.listId)}</span>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            lucide.createIcons();
        }

        function getListTitle(id) {
            const list = userLists.find(l => l.id === id);
            return list ? list.title.substring(0, 8) : 'Liste';
        }

        function addRestaurant() {
            const name = document.getElementById('new-resto-name').value;
            const cuisine = document.getElementById('new-resto-cuisine').value;
            const listId = document.getElementById('new-resto-list').value;

            if (!name) { showNotice("Il faut un nom !"); return; }

            restaurants.unshift({
                id: Date.now(),
                name,
                cuisine: cuisine || "Divers",
                status: 'wishlist',
                rating: 0,
                listId: listId,
                image: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?auto=format&fit=crop&w=600&q=80"
            });

            toggleModal('modal-add-resto');
            // If we are in the list we just added to, refresh, otherwise stay
            if (currentView === 'list' && (currentListFilter === 'main' || currentListFilter === listId)) {
                renderRestaurants();
            } else if (currentView === 'folders' && listId !== 'main') {
                renderFolders(); // Update counts
            }
            
            document.getElementById('new-resto-name').value = '';
            document.getElementById('new-resto-cuisine').value = '';
            showNotice("Adresse ajout√©e !");
        }

        function renderFolders() {
            const grid = document.getElementById('folders-grid');
            grid.innerHTML = userLists.map(list => {
                const count = restaurants.filter(r => r.listId === list.id).length;
                return `
                    <div onclick="openList('${list.id}')" class="glass aspect-[4/3] p-5 flex flex-col justify-between group active:scale-95 transition-all hover:bg-white/10 cursor-pointer rounded-[24px] bg-[#161616] relative">
                        <button onclick="deleteList('${list.id}', event)" class="absolute top-3 right-3 text-white/10 hover:text-red-400 transition-colors p-2">
                            <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                        </button>
                        <div class="w-10 h-10 rounded-2xl bg-white/5 flex items-center justify-center text-white/40 group-hover:text-blue-400 group-hover:bg-blue-500/10 transition-all">
                            <i data-lucide="${list.icon}" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-sm leading-tight mb-1 text-white pr-4 truncate">${list.title}</h3>
                            <p class="text-[9px] text-white/30 font-bold uppercase tracking-widest">${count} Lieux</p>
                        </div>
                    </div>
                `;
            }).join('');
            lucide.createIcons();
        }

        function updateListSelect() {
            const select = document.getElementById('new-resto-list');
            select.innerHTML = `<option value="main">Carnet G√©n√©ral</option>` + 
                userLists.map(l => `<option value="${l.id}">${l.title}</option>`).join('');
        }

        // --- AI (FAST MODEL / SIMULATED) ---
        function generateRecommendations() {
            const btn = document.getElementById('ai-btn');
            const section = document.getElementById('recommendations-section');
            const recoList = document.getElementById('reco-list');

            // UI Loading
            btn.classList.add('animate-spin', 'text-white');
            section.classList.remove('hidden');
            recoList.innerHTML = `
                <div class="flex items-center gap-3 px-4 py-8 text-white/30 animate-pulse">
                    <i data-lucide="loader" class="w-4 h-4 animate-spin"></i>
                    <span class="text-[10px] font-bold uppercase tracking-widest">Recherche en cours...</span>
                </div>`;
            lucide.createIcons();

            // Simulate Network Delay for "Fast Model" feel (500ms)
            setTimeout(() => {
                // Select 3 random distinct items from database
                const shuffled = aiDatabase.sort(() => 0.5 - Math.random());
                const suggestions = shuffled.slice(0, 3);
                
                recoList.innerHTML = suggestions.map(rec => `
                    <div class="min-w-[260px] glass p-5 rounded-[24px] border-l-2 border-yellow-500 bg-[#1a1a1a] snap-center animate-in">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-sm text-white">${rec.name}</h3>
                            <span class="text-[8px] font-black bg-white/10 px-2 py-1 rounded text-white/60 uppercase">${rec.cuisine}</span>
                        </div>
                        <p class="text-[10px] text-white/40 mb-4 italic leading-relaxed">"${rec.reason}"</p>
                        <button onclick="addRecommendationToCarnet('${rec.name.replace(/'/g, "\\'")}', '${rec.cuisine}')" class="w-full py-2.5 rounded-xl bg-yellow-500 text-black text-[10px] font-black uppercase tracking-widest hover:bg-yellow-400 active:scale-95 transition-all flex justify-center items-center gap-2">
                            <i data-lucide="plus" class="w-3 h-3"></i> Ajouter
                        </button>
                    </div>
                `).join('');
                lucide.createIcons();
                btn.classList.remove('animate-spin', 'text-white');
            }, 600);
        }

        function addRecommendationToCarnet(name, cuisine) {
            restaurants.unshift({
                id: Date.now(),
                name: name,
                cuisine: cuisine,
                status: 'wishlist',
                rating: 0,
                listId: currentListFilter, // Add to current context
                image: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?auto=format&fit=crop&w=600&q=80"
            });
            renderRestaurants();
            showNotice(`${name} ajout√© !`);
        }

        function closeRecommendations() {
            document.getElementById('recommendations-section').classList.add('hidden');
        }

        // --- UTILS & MODALS ---
        function toggleModal(id) {
            const modal = document.getElementById(id);
            modal.classList.toggle('hidden');
        }

        function openRestoDetails(id) {
            currentDetailId = id;
            const resto = restaurants.find(r => r.id === id);
            if (!resto) return;

            document.getElementById('detail-image').src = resto.image;
            document.getElementById('detail-name').innerText = resto.name;
            document.getElementById('detail-tags').innerHTML = `<span class="px-2 py-1 bg-white/20 backdrop-blur-md rounded-md text-[9px] font-bold uppercase tracking-widest text-white">${resto.cuisine}</span>`;
            
            const starsContainer = document.getElementById('detail-stars');
            starsContainer.innerHTML = Array(5).fill(0).map((_, i) => 
                `<i data-lucide="star" class="w-3 h-3 ${i < resto.rating ? 'fill-yellow-400' : 'fill-white/10 text-white/20'}"></i>`
            ).join('');

            const btnStatus = document.getElementById('btn-toggle-status');
            if (resto.status === 'visited') {
                btnStatus.innerHTML = `<i data-lucide="bookmark" class="w-5 h-5 text-white"></i><span class="text-[10px] font-bold uppercase tracking-widest text-white">√Ä tester</span>`;
            } else {
                btnStatus.innerHTML = `<i data-lucide="check-circle" class="w-5 h-5 text-emerald-400"></i><span class="text-[10px] font-bold uppercase tracking-widest text-emerald-400">Marquer Fait</span>`;
            }

            lucide.createIcons();
            toggleModal('modal-details');
        }

        function toggleStatusFromDetail() {
            const resto = restaurants.find(r => r.id === currentDetailId);
            if (resto) {
                resto.status = resto.status === 'visited' ? 'wishlist' : 'visited';
                openRestoDetails(currentDetailId);
                renderRestaurants(); // Refresh bg list
                showNotice(resto.status === 'visited' ? "Marqu√© comme visit√©" : "Ajout√© √† la wishlist");
            }
        }

        function deleteRestoFromDetail() {
            if(confirm('Supprimer ce restaurant ?')) {
                restaurants = restaurants.filter(r => r.id !== currentDetailId);
                toggleModal('modal-details');
                renderRestaurants();
                if(currentView === 'folders') renderFolders();
                showNotice("Restaurant supprim√©");
            }
        }

        function setFilter(status) {
            filterStatus = status;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if(btn.dataset.filter === status) {
                    btn.className = "filter-btn text-[9px] font-bold px-3 py-1 rounded-full transition-all bg-white text-black shadow-sm";
                } else {
                    btn.className = "filter-btn text-[9px] font-bold px-3 py-1 rounded-full transition-all text-white/40 hover:text-white hover:bg-white/10";
                }
            });
            renderRestaurants();
        }

        function showNotice(msg) {
            const existing = document.querySelector('.toast-notice');
            if(existing) existing.remove();

            const toast = document.createElement('div');
            toast.className = "toast-notice fixed top-6 left-1/2 -translate-x-1/2 z-[200] px-5 py-2.5 bg-white text-black rounded-full shadow-[0_10px_40px_rgba(0,0,0,0.5)] flex items-center gap-2 animate-in";
            toast.innerHTML = `<i data-lucide="info" class="w-3 h-3"></i><span class="text-[10px] font-black uppercase tracking-widest">${msg}</span>`;
            document.body.appendChild(toast);
            lucide.createIcons();
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 2500);
        }
    </script>
</body>
</html>
